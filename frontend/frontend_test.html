<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fakeye quick test</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 24px; }
    textarea { width: 100%; height: 80px; }
    .card { max-width: 800px; margin: 20px auto; padding: 16px; border: 1px solid #ddd; border-radius: 8px; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; color:white; }
    .green { background:#16a34a } .red { background:#dc2626 } .yellow{ background:#f59e0b } .gray{ background:#6b7280 }
  </style>
</head>
<body>
  <div class="card">
    <h2>Fakeye â€” quick check</h2>
    <textarea id="text"></textarea>
    <div style="margin-top:8px">
      <button id="btn">Check</button>
      <button id="clear">Clear</button>
      <span id="status" style="margin-left:12px"></span>
    </div>

    <div id="result" style="margin-top:12px"></div>
  </div>

  <script>
    const API = "http://127.0.0.1:8000"; // change if needed
    const btn = document.getElementById("btn");
    const clear = document.getElementById("clear");
    const textEl = document.getElementById("text");
    const status = document.getElementById("status");
    const result = document.getElementById("result");

    function badge(verdict) {
      const el = document.createElement("span");
      el.className = "badge";
      el.textContent = verdict || "unknown";
      if (verdict === "likely_real") el.classList.add("green");
      else if (verdict === "suspicious") el.classList.add("red");
      else if (verdict === "uncertain") el.classList.add("yellow");
      else el.classList.add("gray");
      return el;
    }

    btn.onclick = async () => {
      result.innerHTML = ""; status.textContent = "Checking...";
      const text = textEl.value.trim();
      if (!text) { status.textContent = ""; alert("Enter text"); return; }
      try {
        const r = await fetch(API + "/predict", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
        const j = await r.json();
        status.textContent = "";
        if (!r.ok) {
          result.innerHTML = "<div style='color:red'>Error: "+(j.detail||"server error")+"</div>";
          return;
        }
        const h = document.createElement("div");
        h.appendChild(badge(j.verdict));
        h.innerHTML += "<div style='margin-top:8px'><strong>Score:</strong><pre>"+JSON.stringify(j.verdict_score,null,2)+"</pre></div>";
        if (j.top_matches && j.top_matches.length) {
          const ul = document.createElement("ul");
          j.top_matches.forEach(m => {
            const li = document.createElement("li");
            li.innerHTML = `<div><a href="${m.link}" target="_blank">${m.title||m.link}</a></div><div style='font-size:12px;color:#444'>${m.snippet||""}</div>`;
            ul.appendChild(li);
          });
          h.appendChild(ul);
        }
        result.appendChild(h);
      } catch(err) {
        status.textContent = "";
        result.innerHTML = "<div style='color:red'>Network error: "+err.message+"</div>";
      }
    };

    clear.onclick = () => { textEl.value = ""; result.innerHTML = ""; status.textContent = ""; };
  </script>
</body>
</html>
